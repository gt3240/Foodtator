@model Foodtator.Models.ViewModels.BaseViewModel
@using Foodtator.Classes.Extensions

@{
    ViewBag.Title = "Home Page";
    Layout = "~/Views/Shared/_LandingPageLayout.cshtml";
}

@section Styles
{

}

@*full screen loading spinner, add .loading in JS to activate*@
<div id="loadingDiv">
    
</div>

<div class="container">
    <div class="row mobileDashboard">

        <ul id="btnList">
            <li class="col-xs-12 fullWidthButton swing" style="background-color:#9CB4F0; margin-top:40px;">
                <span class="fa fa-cutlery"><span class="icon_text findLoc" class="findLoc">Find a Restaurant</span></span>
            </li>

            <li class="col-xs-12 fullWidthButton swing" style="background-color:#F3BA71;">
                <span class="fa fa-map-marker"><span class="icon_text ">Check In</span></span>
            </li>

            <li class="col-xs-12 fullWidthButton swing" style="background-color:#FF84A7;">
                <span class="fa fa-camera"><span class="icon_text ">Share Picture</span></span>

            </li>

            <li class="col-xs-12 fullWidthButton swing" style="background-color:#7BECED;">

                <span class="fa fa-money"><span class="icon_text">My Points</span></span>
            </li>

            <li class="col-xs-12 fullWidthButton swing" style="background-color:#BD84D6;">
                <span class="fa fa-user"><span class="icon_text ">My Profile</span></span>

            </li>
        </ul>
    </div>

    <div class="row deskTopDashboard">
        <div class="feedContainer col-md-6 col-md-offset-3">

            <div class="feedControlBox text-center">
                <a class="fa fa-cutlery btn btn-block findLoc" style="margin-top:20px;"><br /><span class="icon_text findLoc" >Find a Restaurant</span></a>
                <hr />
                <a class="fa fa-map-marker btn btn-block" id="checkIn" href="/checkin#/selectionLoaded"><br /><span class="icon_text">Check In</span></a>
                <hr />
                <a class="fa fa-camera btn btn-block" id="sharePictures" href="/photoupload"><br /><span class="icon_text">Share Pictures</span></a>
                <hr />
                <a class="fa fa-money btn btn-block" id="myPoints" href="/myPoints"><br /><span class="icon_text">My Points</span></a>
                <hr />
                <a class="fa fa-user btn btn-block" id="myPoints" href="/myPoints"><br /><span class="icon_text">My Profile</span></a>

            </div>
        </div>
    </div>

    
</div>



<script type="application/json" id="modelData">
    @Html.RawJson(Model.AppUser)
</script>

@section scripts{
    <script type="text/javascript">
        var currentLocation = null;

        tkj.page.startUp = function () {
            tkj.page.dashButtons();
            $('.findLoc').on('click', tkj.page.handlers.onFindLoc);
            var userData = JSON.parse($("#modelData").html());
            console.log("user is ", userData);
            tkj.page.getPosition();
        }

        tkj.page.dashButtons = function () {
            $('#btnList li').each(function (i) {
                setTimeout(function () {
                    $('#btnList li').eq(i).addClass('show');
                }, 300 * i);
            });
        }

        tkj.page.getPosition = function () {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function (position) {
                    $.ajax({
                        type: 'GET',
                        url: 'https://maps.googleapis.com/maps/api/geocode/json?latlng=' + position.coords.latitude + ',' + position.coords.longitude,
                        datatype: 'jsonp',
                        success: tkj.page.handlers.success,
                        error: tkj.page.handlers.error
                    });
                });
            }
        }

        tkj.page.handlers.onFindLoc = function () {
            console.log("find loc clicked");
            $('#loadingDiv').addClass('loading');
            window.location.replace("/Results/location/" + currentLocation);
        }

        tkj.page.handlers.success = function (data) {
            console.log(data, "DATA");
            var str = data.results[1].address_components[1].long_name;
            currentLocation = str.replace(/\s+/g, '-');
            if (currentLocation != null) {
                $('.findLoc').text("Find a Restaurant in " + currentLocation);
            } 

            currentLocation = currentLocation.toLowerCase();
            console.log("location is ", currentLocation);
        }

        tkj.page.handlers.error = function (data) {
            alert("Please turn on your loction service.");
        }



    </script>
}