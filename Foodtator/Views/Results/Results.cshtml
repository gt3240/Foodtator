@model YelpSharp.Data.SearchResults
@using Foodtator.Classes.Extensions

@{
    ViewBag.Title = "PageSample";
    Layout = "~/Views/Shared/_LandingPageLayout.cshtml";
}

@section Styles{

    <link href="~/Content/SliderStyle.css" rel="stylesheet" />
}
<div data-ng-controller="resultsController as rc">

    <div class="container slider">
        <div class="row" ng-repeat="slide in rc.data">
            <div class="feedContainer col-md-6 col-md-offset-3" ng-if="rc.activeItem == $index">
                <div>
                    <div class="feedTitleBox">
                        {{slide.name}}
                    </div>
                    <div class="feedImgBox">
                        <img ng-src="{{slide.image_url}}" width="100%" />
                    </div>
                    <div class="feedControlBox">
                        <button class="pull-left btn btn-danger" ng-click="rc.nextSlide($index + 1)">Trash</button>
                        <button class="pull-right btn btn-success" ng-click="rc.selectSlide($index)">select</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!--
    <div class="container slider col-lg-4">
        <div ng-repeat="slide in rc.data">
            <img class="slide" ng-hide="!rc.isCurrentSlideIndex($index)" ng-src="{{slide.image_url}}">
            <button class="btn btn-success selectButton" ng-click="rc.selectSlide(slide)">Eat</button>
            <button class="btn btn-success previousButton" ng-click="rc.prevSlide()">Prev</button>
            <button class="btn btn-warning nextButton" ng-click="rc.nextSlide()">Next</button>
        </div>
        @*<a class="arrow prev" href="#" ng-click="rc.nextSlide()"></a>
        <a class="arrow next" href="#" ng-click="rc.prevSlide()"></a>
        <nav class="SliderNav">
            <div class="wrapper">
                <div class="dot">

                </div>
            </div>
        </nav>*@
    </div>
    -->
</div>

<script type="application/json" id="modelData">
    @Html.RawJson(Model.businesses)
</script>



@section scripts{
    <script src="~/Scripts/FoodTator/Services/ResultsService.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/gsap/1.10.3/TweenMax.min.js"></script>
    <script type="text/javascript">

        (function () {
            "use strict";

            angular.module(APPNAME)
                .controller('resultsController', ResultsController);

            ResultsController.$inject = ['$scope', '$resultsService'];

            function ResultsController(
                $scope
                , $resultsService) {

                var vm = this;
                vm.$scope = $scope;
                vm.$resultsService = $resultsService;
                vm.nextSlide = _nextSlide;
                vm.selectSlide = _selectSlide;
                vm.errMsg = null;
                vm.data = [];
                vm.activeItem = 0;


                init();

                function init() {
                    vm.data = JSON.parse($("#modelData").html());
                    console.log("data is ", vm.data);
                }

                function _setCurrentSlideIndex(index) {
                    vm.currentIndex = index;
                };

                function _isCurrentSlideIndex(index) {
                    return vm.currentIndex === index;
                };

                function _nextSlide(index) {
                    console.log("index is ", index);
                    if (index <= vm.data.length) {
                        vm.activeItem = index;
                    } else {
                        console.log("no more slides");
                    }

                };
                function _selectSlide(payload) {

                    $.ajax({
                        type: 'POST',
                        url: '/api/CheckIn/Selected',
                        data: payload,
                        datatype: 'json',
                        success: _Success,
                        error: _Error
                    });
                };

                function _Success(data) {
                    console.log("Data passed", data);
                }
                function _Error() {
                    console.log("Fail")
                }


            };
        })();
    </script>


}
