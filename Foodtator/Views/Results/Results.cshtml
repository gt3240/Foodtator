@model YelpSharp.Data.SearchResults
@using Foodtator.Classes.Extensions

@{
    ViewBag.Title = "PageSample";
    Layout = "~/Views/Shared/_LandingPageLayout.cshtml";
}

@section Styles{

    <link href="~/Content/SliderStyle.css" rel="stylesheet" />
}
<div data-ng-controller="resultsController as rc">
    <div class="container slider">
        <div ng-repeat="slide in rc.data">
            <img class="slide" ng-hide="!rc.isCurrentSlideIndex($index)" ng-src="{{slide.image_url}}">
            <button class="btn btn-success selectButton" ng-click="rc.selectSlide(slide)">Eat</button>
            
        </div>
        <a class="arrow prev" href="#" ng-click="rc.nextSlide()"></a>
        <a class="arrow next" href="#" ng-click="rc.prevSlide()"></a>
        <nav class="SliderNav">
            <div class="wrapper">
                <div class="dot">
                    <button class="btn btn-success" ng-click="rc.prevSlide()">Prev</button>
                    <button class="btn btn-warning" ng-click="rc.nextSlide()">Next</button>
                </div>
            </div>
        </nav>
    </div>
</div>

<script type="application/json" id="modelData">
    @Html.RawJson(Model.businesses)
</script>


@section scripts{
    <script src="~/Scripts/FoodTator/Services/ResultsService.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/gsap/1.10.3/TweenMax.min.js"></script>
    <script type="text/javascript">

        (function () {
            "use strict";

            angular.module(APPNAME)
                .controller('resultsController', ResultsController);

            ResultsController.$inject = ['$scope', '$resultsService'];

            function ResultsController(
                $scope
                , $resultsService) {

                var vm = this;
                vm.$scope = $scope;
                vm.$resultsService = $resultsService;
                vm.currentIndex = 0;
                vm.setCurrentSlideIndex = _setCurrentSlideIndex;
                vm.isCurrentSlideIndex = _isCurrentSlideIndex;
                vm.prevSlide = _prevSlide;
                vm.nextSlide = _nextSlide;
                vm.selectSlide = _selectSlide;
                vm.errMsg = null;
                vm.data = [];


                init();

                function init() {
                    vm.data = JSON.parse($("#modelData").html());
                    console.log("data is ", vm.data);
                }

                function _setCurrentSlideIndex(index) {
                    vm.currentIndex = index;
                };

                function _isCurrentSlideIndex(index) {
                    return vm.currentIndex === index;
                };
                function _prevSlide() {
                    vm.currentIndex = (vm.currentIndex < vm.data.length - 1) ? ++vm.currentIndex : 0;
                };
                function _nextSlide() {

                    vm.currentIndex = (vm.currentIndex > 0) ? --vm.currentIndex : vm.data.length - 1;
                };
                function _selectSlide(data) {
                    //var payload={
                    //    EstablishmentName:data.name,
                    //    Latitude:data.location.coordinate.latitude,
                    //    Latitude:data.location.coordinate.latitude,
                    //    ImageUrl:data.image_url
                    //};
                    var payload = data;

                    $.ajax({
                        type: 'POST',
                        url: '/api/CheckIn/Selected',
                        data: payload,
                        datatype: 'json',
                        success: _Success,
                        error: data
                    });
                };

                function _Success(data) {
                    console.log("Data passed", data);
                }
                function _Error() {
                    console.log("Fail")
                }


            };
        })();
    </script>


}
